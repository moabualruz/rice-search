# Rice Search Platform - Environment Configuration
# Copy to .env and customize as needed. Works for local dev out of the box.

# ============================================
# Docker Compose Profiles
# ============================================
# Compute: gpu | cpu (pick one)
# Mode: full (API+WebUI in Docker) | dev (Attu for local development)
#
# Examples:
#   gpu,full  = Full GPU platform (default)
#   gpu,dev   = GPU infra + Attu (for local API/WebUI development)
#   cpu,full  = Full CPU platform (no GPU required)
#   cpu,dev   = CPU infra + Attu (for local development)
#
# GPU requires: NVIDIA GPU + nvidia-container-toolkit
COMPOSE_PROFILES=gpu,dev

# ============================================
# HuggingFace (optional, for private models)
# ============================================
HF_TOKEN=

# ============================================
# Repository paths for server-side indexing
# ============================================
REPOS_PATH=./repos

# ============================================
# Model Configuration (Infinity)
# ============================================
# Embedding Models (code-optimized):
#   - jinaai/jina-code-embeddings-1.5b (1536d, Rust/Kotlin/15+ langs) [DEFAULT]
#   - jinaai/jina-code-embeddings-0.5b (1536d, smaller/faster)
#   - nomic-ai/nomic-embed-code (896d, Python/Java/JS/PHP/Ruby/Go only)
#   - mixedbread-ai/mxbai-embed-large-v1 (1024d, general purpose)
EMBED_MODEL=jinaai/jina-code-embeddings-1.5b
EMBEDDING_DIM=1536

# Reranking Models (code-optimized):
#   - jinaai/jina-reranker-v2-base-multilingual (60-80ms, code support) [DEFAULT]
#   - BAAI/bge-reranker-v2-m3 (70-100ms, multilingual)
#   - mixedbread-ai/mxbai-rerank-xsmall-v1 (320ms, general purpose)
RERANK_MODEL=jinaai/jina-reranker-v2-base-multilingual

# Infinity engine: torch (default) | onnx | tensorrt
INFINITY_ENGINE=torch
INFINITY_BATCH_SIZE=32

# ============================================
# Search Configuration
# ============================================
SPARSE_TOPK=100
DENSE_TOPK=100
FINAL_TOPK=20
RRF_K=60

# Reranking
RERANK_ENABLED=true
RERANK_CANDIDATES=30
RERANK_TIMEOUT_MS=100

# ============================================
# API Server Configuration
# ============================================
PORT=8080
NODE_ENV=development
AUTH_MODE=none
API_KEY=
LOG_LEVEL=INFO

# ============================================
# File Indexing Limits
# ============================================
MAX_FILE_SIZE_MB=10
MAX_FILES_PER_BATCH=100

# ============================================
# Infrastructure - Local Development
# ============================================
# These connect to Docker-exposed ports when running API locally
# (Docker Compose overrides these for containerized API)
REDIS_HOST=localhost
REDIS_PORT=6379
MILVUS_HOST=localhost
MILVUS_PORT=19530

# Infinity embedding/reranking server
# Port 8081 is Docker-exposed (maps to container port 80)
INFINITY_URL=http://localhost:8081
INFINITY_EMBED_MODEL=jinaai/jina-code-embeddings-1.5b
INFINITY_RERANK_MODEL=jinaai/jina-reranker-v2-base-multilingual
# 5 minutes timeout for large batch embeddings (300+ chunks)
INFINITY_TIMEOUT_MS=300000

# ============================================
# Data Directories (local development)
# ============================================
# These paths are used when running API locally
# Docker Compose uses bind mounts instead
DATA_DIR=./data/api
TANTIVY_INDEX_DIR=./data/tantivy

# ============================================
# Tantivy CLI (BM25 search)
# ============================================
# For local dev, use cargo run from api/tantivy directory
TANTIVY_USE_CARGO=true
TANTIVY_PROJECT_DIR=./api/tantivy
# For production/Docker, use compiled binary:
# TANTIVY_USE_CARGO=false
# TANTIVY_CLI_PATH=/usr/local/bin/tantivy-cli

# ============================================
# Web UI Configuration
# ============================================
# API URL for Next.js proxy (local dev uses same port as Docker)
API_URL=http://localhost:8080

# ============================================
# ricegrep CLI Configuration
# ============================================
RICEGREP_BASE_URL=http://localhost:8080
RICEGREP_STORE=default

# Search behavior defaults (all enabled by default)
# Set to 0 or false to disable
# RICEGREP_RERANK=true
# RICEGREP_DEDUP=true
# RICEGREP_DIVERSITY=true
# RICEGREP_EXPANSION=true
# RICEGREP_GROUP_BY_FILE=false
# RICEGREP_VERBOSE=false

# Sync limits (optional)
# RICEGREP_MAX_FILE_SIZE=1073741824
# RICEGREP_MAX_FILE_COUNT=10000
